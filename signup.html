---
layout: "base.njk"
title: "Sign Up"
withServer: "True"
---


<form id="signupForm">
  <h2 style="text-align:left;">Signup</h2>
  <div>
    <label for="username">username:</label>
    <input type="username" id="username" placeholder="username" required>
  </div>
  <div>
    <label for="email">Email:</label>
    <input type="email" id="email" placeholder="someone@example.com" required>
  </div>
  <div>
    <label for="password">Password:</label>
    <input type="password" id="password" placeholder="Enter your password" required>
  </div>
  <button type="submit">Create Account</button>
  <div id="message"></div>
</form>
<!--
<button id="google" type="button" style="color: black";>Signup with Google</button>-->


<p>Already have an account? <a href="/login/">Log In</a></p>

<script>
  message = document.getElementById("message");
  signupForm.addEventListener('submit', (e) => {
    e.preventDefault();
    const username = document.getElementById("username").value;
    const email = document.getElementById("email").value;
    const password = document.getElementById("password").value;
    buildReq(2, [username, email, password], "server", 1, 1)
    setInterval(()=>{
      if(GetRes(1)!=undefined){
        if(GetRes(1).content.status==200){
          document.getElementById("message").innerHTML="Please check your email the link will expire in 10 minutes. <br><b>Can't find it... check your spam and junk folders. </b>"
        } else if(GetRes(1).content.status==422){
          document.getElementById("message").innerHTML="Username, email or password must be able to be encoded in ascii. "
          message.style.color="red";
        } else if(GetRes(1).content.status==400){
          document.getElementById("message").innerHTML="Email already exists. "
          message.style.color="red";
        } else if(GetRes(1).content.status==400.5){
          document.getElementById("message").innerHTML="Username already exists. "
          message.style.color="red";
        } else {
          document.getElementById("message").innerHTML="Invalid server response. "
          message.style.color="red";
        }
      }
    }, 5)
  })
</script>

<script type="module">/*
  // All imports now use the bare specifier "firebase/..."
  import { initializeApp } from "firebase/app"; 
  import { 
    getAuth, 
    createUserWithEmailAndPassword, 
    GoogleAuthProvider, 
    signInWithPopup 
  } from "firebase/auth";

  const provider = new GoogleAuthProvider();
  // Your Firebase configuration (you've already added this to your layout file)
  const firebaseConfig = {
    apiKey: "AIzaSyDPTxdGNRcokbHS9fNVxq2VgO_TJcuDP08",
    // ... (rest of your config)
  };

  // Initialize Firebase and get the Auth service
  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);

  const signupForm = document.getElementById('signupForm');
  const emailInput = document.getElementById('email');
  const passwordInput = document.getElementById('password');
  const messageDiv = document.getElementById('message');

  signupForm.addEventListener('submit', (e) => {
    e.preventDefault(); // Stop the form from reloading the page

    const email = emailInput.value;
    const password = passwordInput.value;

    createUserWithEmailAndPassword(auth, email, password)
      .then((userCredential) => {
        // User created successfully!
        messageDiv.innerText = "Account created successfully! Redirecting to login...";
        console.log("New user:", userCredential.user.uid);
        setTimeout(() => {
          window.location.href = "/login/";
        }, 2000); // Redirect after 2 seconds
      })
      .catch((error) => {
        // Handle errors during creation
        const errorMessage = error.message;
        messageDiv.innerText = `Error: ${errorMessage}`;
        console.error("Signup failed:", errorMessage);
      });
  });
  
  document.addEventListener("google", (e) => {
    signInWithPopup(auth, provider)
  .then((result) => {
    // This gives you a Google Access Token. You can use it to access the Google API.
    const credential = GoogleAuthProvider.credentialFromResult(result);
    const token = credential.accessToken;
    // The signed-in user info.
    const user = result.user;

    // You can now access user data like user.displayName, user.email, etc.
    console.log("Signed in as:", user.displayName);
  })
  .catch((error) => {
    // Handle Errors here.
    const errorCode = error.code;
    const errorMessage = error.message;
    // The email of the user's account used.
    const email = error.customData.email;
    // The AuthCredential type that was used.
    const credential = GoogleAuthProvider.credentialFromError(error);
    console.error("Sign-in failed:", errorMessage);
  });
  });*/
</script>
